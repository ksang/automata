package rrul

import (
	"testing"
)

func TestMarshal(t *testing.T) {
	tests := []struct {
		output string
	}{
		{
			`NETPERF_INTERIM_RESULT[0]=11853.26
NETPERF_UNITS[0]=10^6bits/s
NETPERF_INTERVAL[0]=0.200
NETPERF_ENDING[0]=1528545717.442
NETPERF_INTERIM_RESULT[1]=11892.23
NETPERF_UNITS[1]=10^6bits/s
NETPERF_INTERVAL[1]=0.200
NETPERF_ENDING[1]=1528545717.642
NETPERF_INTERIM_RESULT[2]=10238.88
NETPERF_UNITS[2]=10^6bits/s
NETPERF_INTERVAL[2]=0.200
NETPERF_ENDING[2]=1528545717.842
NETPERF_INTERIM_RESULT[3]=11427.42
NETPERF_UNITS[3]=10^6bits/s
NETPERF_INTERVAL[3]=0.200
NETPERF_ENDING[3]=1528545718.042
NETPERF_INTERIM_RESULT[4]=10690.23
NETPERF_UNITS[4]=10^6bits/s
NETPERF_INTERVAL[4]=0.200
NETPERF_ENDING[4]=1528545718.242
NETPERF_INTERIM_RESULT[5]=10386.04
NETPERF_UNITS[5]=10^6bits/s
NETPERF_INTERVAL[5]=0.200
NETPERF_ENDING[5]=1528545718.442
NETPERF_INTERIM_RESULT[6]=10375.61
NETPERF_UNITS[6]=10^6bits/s
NETPERF_INTERVAL[6]=0.200
NETPERF_ENDING[6]=1528545718.642
NETPERF_INTERIM_RESULT[7]=17484.22
NETPERF_UNITS[7]=10^6bits/s
NETPERF_INTERVAL[7]=0.200
NETPERF_ENDING[7]=1528545718.842
NETPERF_INTERIM_RESULT[8]=20616.85
NETPERF_UNITS[8]=10^6bits/s
NETPERF_INTERVAL[8]=0.200
NETPERF_ENDING[8]=1528545719.042
NETPERF_INTERIM_RESULT[9]=20446.21
NETPERF_UNITS[9]=10^6bits/s
NETPERF_INTERVAL[9]=0.200
NETPERF_ENDING[9]=1528545719.242
NETPERF_INTERIM_RESULT[10]=20297.18
NETPERF_UNITS[10]=10^6bits/s
NETPERF_INTERVAL[10]=0.200
NETPERF_ENDING[10]=1528545719.442
NETPERF_INTERIM_RESULT[11]=20687.23
NETPERF_UNITS[11]=10^6bits/s
NETPERF_INTERVAL[11]=0.200
NETPERF_ENDING[11]=1528545719.642
NETPERF_INTERIM_RESULT[12]=20751.32
NETPERF_UNITS[12]=10^6bits/s
NETPERF_INTERVAL[12]=0.200
NETPERF_ENDING[12]=1528545719.842
NETPERF_INTERIM_RESULT[13]=20392.25
NETPERF_UNITS[13]=10^6bits/s
NETPERF_INTERVAL[13]=0.200
NETPERF_ENDING[13]=1528545720.043
NETPERF_INTERIM_RESULT[14]=20552.19
NETPERF_UNITS[14]=10^6bits/s
NETPERF_INTERVAL[14]=0.200
NETPERF_ENDING[14]=1528545720.243
NETPERF_INTERIM_RESULT[15]=18609.54
NETPERF_UNITS[15]=10^6bits/s
NETPERF_INTERVAL[15]=0.001
NETPERF_ENDING[15]=1528545720.244
THROUGHPUT=15868.56
LOCAL_CONG_CONTROL=Unavailable
REMOTE_CONG_CONTROL=Unavailable
TRANSPORT_MSS=16332
LOCAL_TRANSPORT_RETRANS=-1
REMOTE_TRANSPORT_RETRANS=-1
LOCAL_SOCKET_TOS=0x20
REMOTE_SOCKET_TOS=0x20
DIRECTION=Send
ELAPSED_TIME=3.00
PROTOCOL=TCP
LOCAL_SEND_SIZE=131072
LOCAL_RECV_SIZE=0
REMOTE_SEND_SIZE=-1
REMOTE_RECV_SIZE=131072`,
		},
		{
			`NETPERF_INTERIM_RESULT[0]=20174.18
NETPERF_UNITS[0]=10^6bits/s
NETPERF_INTERVAL[0]=0.200
NETPERF_ENDING[0]=1528545720.498
NETPERF_INTERIM_RESULT[1]=19555.18
NETPERF_UNITS[1]=10^6bits/s
NETPERF_INTERVAL[1]=0.200
NETPERF_ENDING[1]=1528545720.698
NETPERF_INTERIM_RESULT[2]=21015.03
NETPERF_UNITS[2]=10^6bits/s
NETPERF_INTERVAL[2]=0.200
NETPERF_ENDING[2]=1528545720.898
NETPERF_INTERIM_RESULT[3]=20622.09
NETPERF_UNITS[3]=10^6bits/s
NETPERF_INTERVAL[3]=0.200
NETPERF_ENDING[3]=1528545721.098
NETPERF_INTERIM_RESULT[4]=20856.53
NETPERF_UNITS[4]=10^6bits/s
NETPERF_INTERVAL[4]=0.200
NETPERF_ENDING[4]=1528545721.298
NETPERF_INTERIM_RESULT[5]=20847.01
NETPERF_UNITS[5]=10^6bits/s
NETPERF_INTERVAL[5]=0.200
NETPERF_ENDING[5]=1528545721.498
NETPERF_INTERIM_RESULT[6]=20318.10
NETPERF_UNITS[6]=10^6bits/s
NETPERF_INTERVAL[6]=0.200
NETPERF_ENDING[6]=1528545721.698
NETPERF_INTERIM_RESULT[7]=18813.23
NETPERF_UNITS[7]=10^6bits/s
NETPERF_INTERVAL[7]=0.200
NETPERF_ENDING[7]=1528545721.898
NETPERF_INTERIM_RESULT[8]=13149.01
NETPERF_UNITS[8]=10^6bits/s
NETPERF_INTERVAL[8]=0.200
NETPERF_ENDING[8]=1528545722.098
NETPERF_INTERIM_RESULT[9]=19180.92
NETPERF_UNITS[9]=10^6bits/s
NETPERF_INTERVAL[9]=0.200
NETPERF_ENDING[9]=1528545722.299
NETPERF_INTERIM_RESULT[10]=20651.39
NETPERF_UNITS[10]=10^6bits/s
NETPERF_INTERVAL[10]=0.200
NETPERF_ENDING[10]=1528545722.499
NETPERF_INTERIM_RESULT[11]=19818.05
NETPERF_UNITS[11]=10^6bits/s
NETPERF_INTERVAL[11]=0.200
NETPERF_ENDING[11]=1528545722.699
NETPERF_INTERIM_RESULT[12]=20052.97
NETPERF_UNITS[12]=10^6bits/s
NETPERF_INTERVAL[12]=0.200
NETPERF_ENDING[12]=1528545722.899
NETPERF_INTERIM_RESULT[13]=19767.05
NETPERF_UNITS[13]=10^6bits/s
NETPERF_INTERVAL[13]=0.200
NETPERF_ENDING[13]=1528545723.099
NETPERF_INTERIM_RESULT[14]=20091.84
NETPERF_UNITS[14]=10^6bits/s
NETPERF_INTERVAL[14]=0.200
NETPERF_ENDING[14]=1528545723.299
NETPERF_INTERIM_RESULT[15]=19784.45
NETPERF_UNITS[15]=10^6bits/s
NETPERF_INTERVAL[15]=0.000
NETPERF_ENDING[15]=1528545723.299
THROUGHPUT=19656.24
LOCAL_CONG_CONTROL=Unavailable
REMOTE_CONG_CONTROL=Unavailable
TRANSPORT_MSS=16332
LOCAL_TRANSPORT_RETRANS=-1
REMOTE_TRANSPORT_RETRANS=-1
LOCAL_SOCKET_TOS=0x20
REMOTE_SOCKET_TOS=0x20
DIRECTION=Receive
ELAPSED_TIME=3.00
PROTOCOL=TCP
LOCAL_SEND_SIZE=0
LOCAL_RECV_SIZE=131072
REMOTE_SEND_SIZE=131072
REMOTE_RECV_SIZE=-1`,
		},
		{
			`NETPERF_INTERIM_RESULT[0]=0.35
NETPERF_UNITS[0]=10^6bits/s
NETPERF_INTERVAL[0]=0.200
NETPERF_ENDING[0]=1528545723.525
NETPERF_INTERIM_RESULT[1]=0.37
NETPERF_UNITS[1]=10^6bits/s
NETPERF_INTERVAL[1]=0.200
NETPERF_ENDING[1]=1528545723.725
NETPERF_INTERIM_RESULT[2]=0.37
NETPERF_UNITS[2]=10^6bits/s
NETPERF_INTERVAL[2]=0.200
NETPERF_ENDING[2]=1528545723.925
NETPERF_INTERIM_RESULT[3]=0.36
NETPERF_UNITS[3]=10^6bits/s
NETPERF_INTERVAL[3]=0.200
NETPERF_ENDING[3]=1528545724.126
NETPERF_INTERIM_RESULT[4]=0.36
NETPERF_UNITS[4]=10^6bits/s
NETPERF_INTERVAL[4]=0.200
NETPERF_ENDING[4]=1528545724.326
NETPERF_INTERIM_RESULT[5]=0.37
NETPERF_UNITS[5]=10^6bits/s
NETPERF_INTERVAL[5]=0.200
NETPERF_ENDING[5]=1528545724.526
NETPERF_INTERIM_RESULT[6]=0.38
NETPERF_UNITS[6]=10^6bits/s
NETPERF_INTERVAL[6]=0.200
NETPERF_ENDING[6]=1528545724.726
NETPERF_INTERIM_RESULT[7]=0.36
NETPERF_UNITS[7]=10^6bits/s
NETPERF_INTERVAL[7]=0.200
NETPERF_ENDING[7]=1528545724.926
NETPERF_INTERIM_RESULT[8]=0.34
NETPERF_UNITS[8]=10^6bits/s
NETPERF_INTERVAL[8]=0.200
NETPERF_ENDING[8]=1528545725.126
NETPERF_INTERIM_RESULT[9]=0.34
NETPERF_UNITS[9]=10^6bits/s
NETPERF_INTERVAL[9]=0.200
NETPERF_ENDING[9]=1528545725.326
NETPERF_INTERIM_RESULT[10]=0.36
NETPERF_UNITS[10]=10^6bits/s
NETPERF_INTERVAL[10]=0.200
NETPERF_ENDING[10]=1528545725.526
NETPERF_INTERIM_RESULT[11]=0.37
NETPERF_UNITS[11]=10^6bits/s
NETPERF_INTERVAL[11]=0.200
NETPERF_ENDING[11]=1528545725.726
NETPERF_INTERIM_RESULT[12]=0.37
NETPERF_UNITS[12]=10^6bits/s
NETPERF_INTERVAL[12]=0.200
NETPERF_ENDING[12]=1528545725.926
NETPERF_INTERIM_RESULT[13]=0.37
NETPERF_UNITS[13]=10^6bits/s
NETPERF_INTERVAL[13]=0.200
NETPERF_ENDING[13]=1528545726.126
NETPERF_INTERIM_RESULT[14]=0.37
NETPERF_UNITS[14]=10^6bits/s
NETPERF_INTERVAL[14]=0.200
NETPERF_ENDING[14]=1528545726.326
NETPERF_INTERIM_RESULT[15]=0.33
NETPERF_UNITS[15]=10^6bits/s
NETPERF_INTERVAL[15]=0.001
NETPERF_ENDING[15]=1528545726.327
THROUGHPUT=0.36
LOCAL_CONG_CONTROL=
REMOTE_CONG_CONTROL=
TRANSPORT_MSS=-1
LOCAL_TRANSPORT_RETRANS=-1
REMOTE_TRANSPORT_RETRANS=-1
LOCAL_SOCKET_TOS=0x20
REMOTE_SOCKET_TOS=0x20
DIRECTION=Send|Recv
ELAPSED_TIME=3.00
PROTOCOL=UDP
LOCAL_SEND_SIZE=0
LOCAL_RECV_SIZE=0
REMOTE_SEND_SIZE=1
REMOTE_RECV_SIZE=1`,
		},
		{
			`NETPERF_INTERIM_RESULT[0]=0.35
NETPERF_UNITS[0]=10^6bits/s
THROUGHPUT=0.36`,
		},
	}
	for _, te := range tests {
		ret, thr, err := MarshalOutput([]byte(te.output))
		if err != nil {
			t.Errorf("error: %v\n", err)
		}
		t.Logf("result: %#v\nthroughput: %f", ret, thr)
	}
}
